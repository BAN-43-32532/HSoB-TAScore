# HSoB TAScore

## 虚拟机

虚拟机用于游戏状态保存和读取，即 SL。Windows 目前没有单进程存取的轻量化工具，推荐将游戏运行在 VMware Workstation pro 17.5 中的 Windows 虚拟机上，用它的快照功能记录游戏阶段状态，同时对游戏崩溃等潜在问题起到保险作用。快照的树状结构既实现了增量存储，也对 TAS 路线探索有一定帮助。

单帧操作通过修改弹幕风脚本实现，无需（也无法）使用 [Hourglass](https://tasvideos.org/EmulatorResources/Hourglass) 或 [libTAS](https://tasvideos.org/EmulatorResources/LibTAS)。故大部分 Windows 系统理论上都可用于运行游戏的虚拟机。

注：

- Hourglass 运行在 Windows 32 位上，项目本身有诸多 bug，使用颇为不便，不过目前是大部分 Windows 游戏（包括东方正作和部分弹幕风游戏）的通用方案。本游戏和 Hourglass 不兼容。
- libTAS 运行在 Linux 各发行版上，主要是 Ubuntu。可以通过 WSL2 / Linux 虚拟机 + [Wine](https://www.winehq.org/) + libTAS 的形式运行 Windows 游戏，但是配置极为繁琐。

### Windows 7 64位

可在 [Internet Archive](https://archive.org/) 搜索相关 iso 文件。建议 "Windows 7 Ultimate SP1" 64bit 版本。32 位系统内存上限 4 GB，游戏本体可能卡顿；Windows XP 等较老的系统对现代图形 API 支持较差，不建议选择；Windows 8 以上系统额外消耗资源较多，不过也可选择。

### 补丁

Windows 7 对 SHA-2 证书支持不足，需要安装官方补丁 [KB4490628](https://www.catalog.update.microsoft.com/search.aspx?q=4490628) 和 [KB4474419](https://www.catalog.update.microsoft.com/Search.aspx?q=4474419) 后才能安装 VMware Tool。

使用 [ImgBurn](https://www.imgburn.com/) 将补丁打包为 iso 文件，在宿主机和虚拟机中传递。此方法也可用于其他文件的传递，不过安装 VMware Tool 后有共享文件夹这一更加便捷的方案。

## Useful (and Legal) Glitches for TAS

- 低速 glitch：低速键于游戏进行时按下，游戏暂停时（如ESC）松开，此时自机为高速（高移速且翠机体高速效果启用），但保持道具自动吸取状态，判定点也会始终显示。
  - 通过游戏进行时触发低速键松开这一事件解除此状态。可以游戏暂停时按下低速键而解除暂停时正好松开低速键。
- 实时间显示 glitch：spell记时终止至击破时间显示之间暂停游戏，实时间会倒流。
  - 原理是游戏通过给开始时间加上暂停时长，来自动补偿游戏暂停期间的时间流逝。然而spell记时终止后结束时间已经固定，而开始时间仍会因为游戏暂停而增加。
  - 注意符卡内ESC不会影响击破时间，replay 也不记录。所以上述低速 glitch 不涉及对游戏的改动。游戏回放完全一致。

## Mod

- [x] 单帧操作
- [ ] 音乐帧进
- [ ] 长按慢速前进
- [ ] 慢速可调
- [ ] 绘制自机判定
- 🟧 绘制子弹判定
  - 用 python 读取 ShotData 数据并直接在解包得到的子弹贴图上绘制判定圆
- 🟧 绘制激光判定
- [ ] 半透明化子弹、敌机贴图
- [ ] 绘制体术和受击范围
- [ ] 绘制下一帧移动位置（当前的高速或低速）
- [ ] 视子弹静止显示某移动是否被弹/体术
- [ ] 视子弹匀速显示某移动是否被弹/体术
- [ ] SlowGlitch 状态指示
- [x] 解禁 Graze 显示上限
- [x] 解禁 PIV 显示上限
- [x] 按键显示
- [x] 隐藏两个FPS显示
- [x] 杂鱼血量显示
- [ ] 不依赖虚拟机的 SL（弹幕风本体支持？）
- [ ] 取消 Boss 血量、SCB等靠近虚化
- [ ] 关闭更多视觉遮挡、高性能需求效果（若有必要）
- [ ] 验证游戏一致性
- [ ] 验证 Replay 一致性
- [x] ZSpell Cutin 调整
- [ ] 存、读档次数、总帧数自动记录
- [ ] 贴图修改（解包）？

## 后期

- [ ] 高画质不掉帧录制
- [ ] 解说模板
- [ ] 游戏机制介绍
- [ ] 游戏背景、角色介绍
- [ ] 贴图、立绘资源
- [ ] 数学推导
- [ ] TAS 过程记录、环境演示
- [ ] SlowGlitch 原理解释
- [ ] 双语
- [ ] 检证、TASVideos、TRS；rep、环境公开

## 路线（拟）

### Boss

#### 一面

##### 道中非

- [ ] 擦弹，两波一B？一波一B？
- [ ] 擦向上移动及炸开前的子弹？

##### 道中符

- [ ] 绕圈？
- [ ] 灵击接道中非第三波道具？
- [ ] 何时Miss？是否抱B？
- [ ] 0残3-4B进后半？

##### 一非

- [ ] ZSpell？
- [ ] SlowGlitch 或 B？

##### 一符

- [ ] 拖全全擦

##### 二非

- [ ] ZSpell？
- [ ] SlowGlitch 或 B？

##### 二符

- [ ] 穿墙或找最集中的时候擦弹？

##### LW

- [ ] 引弹方式
- [ ] 乱弹收益

#### 二面

##### 一非

##### 一符

##### 二非

##### 二符

##### 三符

##### LW

- [ ] ZSpell 使用与补充？

#### 三面

- [ ] 使魔击破与擦弹平衡？

##### 道中非

- [ ] 速破？

##### 道中符

- [ ] 速破？

##### 一非

##### 一符

##### 二非

##### 二符

##### 三非

##### 三符

##### 四符

##### LW

- [ ] ZSpell 使用与补充？

#### 四面

- [ ] 使魔击破与擦弹平衡？

##### 道中符

- [ ] 速破？

##### 一非

##### 一符

##### 二非

##### 二符

##### 三非

##### 三符

##### 四符

##### LW

- [ ] ZSpell 使用与补充？

#### 五面

##### 道中一符

- [ ] Zspell 速破？
- [ ] 擦弹及boss掉落转化？

##### 道中二非

- [ ] 灵击速破？

##### 道中二符

- [ ] ZSpell 速破？

##### 一非

##### 一符

##### 二非

##### 二符

##### 三非

##### 三符

##### 四非

##### 四符

##### 五符

##### LW

- [ ] 内外避？穿墙？
- [ ] 擦弹位置？
- [ ] 是否进P2？
- [ ] 是否击破？
- [ ] ZSpell 使用与补充？

#### 六面

##### 一非

##### 一符

##### 二非

##### 二符

##### 三非

##### 三符

##### 四非

##### 四符

##### 五非

##### 五符

##### 六符

##### 七符

- [ ] 四次 ZSpell（及需要提前准备的充能量）？

### 道中擦弹、击破、灵击路线

- [ ] 待补充……

### 全关路线

- [ ] 灵击等级、价值换算（结晶、消弹）
- [ ] 魔翠最优性证明（或证伪）
- [ ] 待补充……
